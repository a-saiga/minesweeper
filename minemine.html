
<html>
<head>
<title>test</title>
<style type="text/css">
.tile {
  border: 1px solid #888;
  position: absolute;
  text-align: center;
  font-size: 8px;
}
</style>



<script type="text/javascript">
(function() {
window.onload = function() {
  var MAX_WIDTH  = 10;
  var MAX_HEIGHT = 10;
  var WIDTH = 20;
  var HEIGHT = 20;

  var tileCount = null;
  var tiles = [];
  var tileElement = []; 
  
  init();

  function init() {
    tileCount = MAX_WIDTH * MAX_HEIGHT;
    var base = document.getElementById('base');
    for (var i = 0; i < MAX_WIDTH; i++) {
      tiles[i] = [];
      tileElement[i] = [];
      for(var j = 0; j < MAX_HEIGHT; j++) {
        tiles[i][j] = 0;
        var tile = document.createElement('div');
        tile.style.backgroundColor = '#eee';
        tile.style.width = WIDTH + "px";
        tile.style.height = HEIGHT + "px";
        tile.style.left = (i * WIDTH) + "px";
        tile.style.top = (j * HEIGHT) + "px";
        tile.className = "tile";
        (function (n, m) {
          tile.onclick = function() {
            var isClear = selectTile(n, m, true, n, m);
            if (isClear) {
              alert('CLEAR');
              init();
            }
        }
        })(i, j);
        //making mine
        var rand = Math.random() * 10 + 1;
        tile.innerHTML = '';
        if (rand > 9.5) {
          tiles[i][j] = 1;
          tileCount--;
          //tile.style.backgroundColor = '#f00';
          //tile.innerHTML = "��";
        } else {
          //tile.innerHTML = i+':'+j;
        }
        tileElement[i][j] = tile;
        base.appendChild(tile);
      }
    }
  }

  function selectTile(i, j, isClick, orgI, orgJ) {
    if (isClick && tiles[i][j] == 1) {
      gameover();
      if (confirm("GAME ORVER\nRESTART?")) {
        init();
      }
      return false;
    } else if (tiles[i][j] == 2) {
      return false;
    }

    tileCount--;
    tiles[i][j] = 2;
    
    var bomCount = 0;
    for (var n = i-1; n <= i + 1; n++) {
      if (n < 0 || n >= MAX_WIDTH) {
        continue;
      }
      for (var m = j-1; m <= j +1; m++) {
        if (0 <= m && m < MAX_HEIGHT) {
          if (tiles[n][m] == 1) {
            bomCount++;
          }
        }
      }
    }

    tileElement[i][j].innerHTML = bomCount;
    tileElement[i][j].style.backgroundColor = '#bbb';

    if (bomCount == 0) {
      for (var n = i-1; n <= i + 1; n++) {
        if (n < 0 || n >= MAX_WIDTH) {
          continue;
        }
        for (var m = j-1; m <= j + 1; m++) {
          if (0 <= m && m < MAX_HEIGHT) {
            if ((n == i && m ==j) || (n == orgI && m == orgJ)) {
              // OWN TILE or CLICK TILE
            } else {
              selectTile(n, m, false, orgI, orgJ);
            }
          }
        }
      }
    }

    if (tileCount == 0) {
      return true;
    } else {
      return false;
    }
  }

  function gameover() {
    for (var i = 0; i < MAX_WIDTH; i++) {
      for(var j = 0; j < MAX_HEIGHT; j++) {
        if (tiles[i][j] == 1) {
          tileElement[i][j].innerHTML = 'o';
          tileElement[i][j].style.backgroundColor = '#f00';
        }
      }
    }
  }

}
})();
</script>
</head>
<body>
  <div id="base"></div>
</body>
</html>
